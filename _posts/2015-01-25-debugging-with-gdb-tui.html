---
layout: post
title: Debugging Assembly Code with GDB TUI
date: '2015-01-25T18:47:00.001-08:00'
author: Steven Lavoie
tags:
- linux
- tutorial
- reversing
- assembly
modified_time: '2015-05-30T20:53:28.710-07:00'
thumbnail: http://3.bp.blogspot.com/-S-0KFYKtX4w/VWqB6R5CBMI/AAAAAAAAUw4/2SiLCCd7aCs/s72-c/Apple_II_Monitor.png
blogger_id: tag:blogger.com,1999:blog-1636451537745562628.post-8278826472473809196
blogger_orig_url: http://imtryingtoscience.blogspot.com/2015/01/debugging-with-gdb-tui.html
---

<div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><table cellpadding="0" cellspacing="0" class="tr-caption-container" style="float: left; margin-right: 1em; text-align: left;"><tbody><tr><td style="text-align: center;"><a href="http://3.bp.blogspot.com/-S-0KFYKtX4w/VWqB6R5CBMI/AAAAAAAAUw4/2SiLCCd7aCs/s1600/Apple_II_Monitor.png" imageanchor="1" style="clear: left; margin-bottom: 1em; margin-left: auto; margin-right: auto;"><img border="0" height="217" src="http://3.bp.blogspot.com/-S-0KFYKtX4w/VWqB6R5CBMI/AAAAAAAAUw4/2SiLCCd7aCs/s320/Apple_II_Monitor.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;"><a href="http://commons.wikimedia.org/wiki/File:Apple_II_Monitor.png" target="_blank">WikiMedia Commons</a></td></tr></tbody></table><span style="font-family: Tahoma, sans-serif; font-size: 17.3333339691162px;">This is just a mini introduction to using <a href="https://sourceware.org/gdb/onlinedocs/gdb/TUI.html" target="_blank">GDB's text user interface, or GDBTUI</a>.&nbsp;</span><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">I use a Linux VM on my home laptop; tunneling in to my university's linux server is painfully slow, so I just develop locally and then scp (ssh copy) my complete ASM file to the university server to verify that it compiles/runs there. If you have a Linux box that struggles with a VM, try out a new window manager like </span><a href="http://openbox.org/wiki/Main_Page" style="font-family: Tahoma, sans-serif; font-size: 13pt;" target="_blank">OpenBox</a><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">. It's very minimalist and won't bog your system down as much as </span><a href="https://www.gnome.org/" style="font-family: Tahoma, sans-serif; font-size: 13pt;" target="_blank">Gnome</a><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">&nbsp;</span><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">or </span><a href="https://www.kde.org/" style="font-family: Tahoma, sans-serif; font-size: 13pt;" target="_blank">KDE</a><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">, though you'll lose some fancy features</span><span style="font-family: Tahoma, sans-serif; font-size: 13pt;">.</span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">On my Linux VM, I use <a href="http://www.geany.org/" target="_blank">Geany</a>, just a text editor with source highlighting and some other features. The method here also works fine if you're sticking with vi or emacs. Geany is a GUI app similar to <a href="https://notepad-plus-plus.org/" target="_blank">Notepad++</a> on Windows. Unless you're using an IDE like <a href="http://www.codeblocks.org/" target="_blank">Codeblocks</a>(which I'm not a fan of for assembly), you're probably using GDB to debug. GDB can be a pain to use with input and output, usually by redirecting input/output to another terminal or files, or integrating it into vi/emacs.&nbsp;<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">First, you just open/edit the ASM file in Geany, for this example it's "Homework2.asm". I have three terminals:<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Terminal 1:</span></b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;"> Use to compile/run the app with the Homework2.sh script. The app runs, allowing me to use it as normal. Simply type: <b>./Homework2.out</b>. It runs the app and, in this case, just sits there waiting for you to enter the first number.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Terminal 2:</span></b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;"> This terminal is solely for getting the process ID of my running app. While the app is sitting in Terminal 1 waiting for input, I type "ps aux | grep Homework2.out" in this terminal. This lists all the processes with "Homework2.out" in the process name. It'll show geany, GDB if it's already running and the app running in the first terminal, like this:<o:p></o:p></span></div><pre style="background: #000000; color: #d1d1d1;">steve@debian<span style="color: #d2cd86;">:</span>~$ ps aux <span style="color: #e34adc;">|</span> grep Homework2<span style="color: #e66170; font-weight: bold;">.</span>out<br />steve  <span style="color: #008c00;">5180</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">0</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">2</span>  <span style="color: #008c00;">44668</span> <span style="color: #008c00;">11284</span> <span style="color: #66347b;">pts/0</span>  S+ <span style="color: #008c00;">08</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">30</span>   <span style="color: #008c00;">0</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">00</span> <span style="color: #66347b;">/usr/bin/gdb</span> --tui Homework2<span style="color: #e66170; font-weight: bold;">.</span>out<br />steve  <span style="color: #008c00;">5346</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">0</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">0</span>   <span style="color: #008c00;">2004</span>   <span style="color: #008c00;">268</span> <span style="color: #66347b;">pts/2</span>  S+ <span style="color: #008c00;">08</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">34</span>   <span style="color: #008c00;">0</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">00</span> <span style="color: #e66170; font-weight: bold;">.</span><span style="color: #66347b;">/Homework2.out</span><br />steve  <span style="color: #008c00;">5349</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">0</span>  <span style="color: #008c00;">0</span><span style="color: #e66170; font-weight: bold;">.</span><span style="color: #008c00;">0</span>   <span style="color: #008c00;">8024</span>   <span style="color: #008c00;">912</span> <span style="color: #66347b;">pts/3</span>  S+ <span style="color: #008c00;">08</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">35</span>   <span style="color: #008c00;">0</span><span style="color: #d2cd86;">:</span><span style="color: #008c00;">00</span> grep --color<span style="color: #d2cd86;">=</span>auto Homework2<span style="color: #e66170; font-weight: bold;">.</span>out<br /></pre><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">That second one is my program running in Terminal 1. Its process ID is 5346, the first four-digit number on that line.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Terminal 3:</span></b><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;"> In this terminal, I run GDBTUI. Just type <b>./gdbtui</b>. An overview of the TUI features can be found <a href="https://sourceware.org/gdb/onlinedocs/gdb/TUI.html" target="_blank">here</a>.&nbsp;Size this terminal properly before running GDBTUI... there's sometimes a goofy bug, depending on your WM, that will crash it if you do it afterwards. I just make the terminal about twice its regular size. There's multiple layouts available for GDBTUI. The one that's best for us has three "windows" in the terminal: "Registers", "Assembly", and "Command".&nbsp;<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Once GDBTUI is running, you'll be at the GDB command prompt. The commands in GDBTUI are all the same as they are for GDB: si, c, r, etc. There's some extra TUI commands. First, type <b>layout prev</b>. This should just bring you to a layout that shows the three "windows" I mentioned above. If not, continue cycling with <b>layout next</b> or <b>layout prev</b> to see the other layouts.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Now that you've got the proper layout, just type <b>attach 5346</b> and GDB will attach to your program in Terminal 1. Set your breakpoints as needed and you can now interact with the app in Terminal 1 while viewing the assembly and register values in the GDBTUI interface.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">Some extra things that may help you:<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">&nbsp;- You can adjust the individual "windows" in GDBTUI. Type <b>info win</b>&nbsp;to get a list of the "windows" in the interface. For example:<o:p></o:p></span><br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #d2cd86;">(</span>gdb<span style="color: #d2cd86;">)</span> info win <br />        <span style="color: #008073;">ASM</span>     (<span style="color: #008c00;">13</span> lines)<br />        REGS    <span style="color: #d2cd86;">(</span><span style="color: #008c00;">12</span> lines<span style="color: #d2cd86;">)</span><br />        CMD     <span style="color: #d2cd86;">(</span><span style="color: #008c00;">12</span> lines<span style="color: #d2cd86;">)</span>  <span style="color: #b060b0;">&lt;</span>has focus<span style="color: #b060b0;">&gt;</span><br /></pre><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">To adjust the heights, described in lines of text, just type <b>winheight ASM +5</b>. Substitute <b>ASM </b>for whatever window and you can use +/- to adjust the height.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">- You can change the focus within GDBTUI. Notice CMD has focus for me. That means I can use Up and Down to scroll through previously commands. Change focus by typing <b>focus CMD</b>, replacing <b>CMD </b>with whatever window. If you focus on <b>ASM</b>, you can use Up and Down to scroll through the code in the disassembly window.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">- Place labels throughout your code, like after parts of code getting input so GDBTUI will pause there and you can continue stepping through with "si" line-by-line. GDBTUI will automatically step into the functions read_int, read_char and whatever else, so I always place a random label after all my input/output. For me, I set a breakpoint at asm_main to start. I type <b>c</b> in GDB so it just continues and waits for my input since that's the first thing I do. After the input, it'll just continue. I want it to break right after that, so I just have a label called "cmps" after all my input/output so I don't have to step through all of the instructions in read_int/read_char (and there's a lot!). I just set a new breakpoint at cmps, do my input and GDB breaks after that.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><br /></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">- You can view memory locations and the stack like this:<o:p></o:p></span></div><pre style="background: #000000; color: #d1d1d1;"><span style="color: #d2cd86;">(</span>gdb<span style="color: #d2cd86;">)</span> x<span style="color: #d2cd86;">/</span><span style="background: #dd0000; color: white;">10x</span> $sp<br /><span style="color: #00a800;">0xffcb1c40</span><span style="color: #e34adc;">:</span>     <span style="color: #00a800;">0xf7561940</span>      <span style="color: #00a800;">0x00000400</span>      <span style="color: #00a800;">0xf7733000</span>      <span style="color: #00a800;">0xf763bf13</span><br /><span style="color: #00a800;">0xffcb1c50</span><span style="color: #e34adc;">:</span>     <span style="color: #00a800;">0xf7709000</span>      <span style="color: #00a800;">0xf75d1ab3</span>      <span style="color: #00a800;">0x00000000</span>      <span style="color: #00a800;">0xf7733000</span><br /><span style="color: #00a800;">0xffcb1c60</span><span style="color: #e34adc;">:</span>     <span style="color: #00a800;">0x00000400</span>      <span style="color: #00a800;">0x00000001</span><br /><span style="color: #d2cd86;">(</span>gdb<span style="color: #d2cd86;">)</span></pre><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;">The first <b>x</b> is for "examine". The <b>/10x</b>&nbsp;tells GDB how many words to display. You can increase or decrease "10" as needed. The <b>$sp</b>&nbsp;is the location. <b>$sp</b> tells GDB to display starting at the stack pointer. You can replace <b>$sp</b> with a memory location like <b>0xffcb1c40</b>&nbsp;to view the contents of a variable.<o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-size: 13.0pt;"><span style="font-family: Tahoma, sans-serif;"><br /></span></span><span style="font-size: 13.0pt;"><span style="font-family: Tahoma, sans-serif;">- Most systems should have </span><span style="font-family: Courier New, Courier, monospace;">disable-randomization</span><span style="font-family: Tahoma, sans-serif;">&nbsp;set by default. If not, just type </span></span><span style="font-family: Courier New, Courier, monospace; font-size: 13.0pt; mso-bidi-font-family: Courier;">set disable-randomization on</span><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 14.0pt;">. </span><span style="font-family: &quot;Tahoma&quot;,sans-serif;">This causes GDB to reuse the same memory locations over and over while you're debugging. It makes it easier since you'll start to become familiar with memory locations and won't have to look those up every time you run the app.</span><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;"><o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif;"><br /></span><span style="font-family: &quot;Tahoma&quot;,sans-serif;">-&nbsp;This is a great reference to have open while coding too:&nbsp;<span style="color: #0000e9; font-size: 13.0pt;"><a href="http://x86.renejeschke.de/">http://x86.renejeschke.de/</a>.</span></span><br /><span style="font-family: &quot;Tahoma&quot;,sans-serif;"><span style="color: #0000e9; font-size: 13.0pt;"><br /></span></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif;">Once the app crashes or closes, GDBTUI will still be open. You can simply make changes as needed in Geany/vi/emacs and run through the same process outlined above: run it in Terminal 1, get the process ID in Terminal 2 and attach GDBTUI in Terminal 3. Since GDBTUI continues running even after the app dies, it'll maintain memory addresses, etc.</span><span style="font-family: &quot;Tahoma&quot;,sans-serif; font-size: 13.0pt;"><o:p></o:p></span></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"></div><div class="MsoNormal" style="margin-bottom: .0001pt; margin-bottom: 0in; mso-layout-grid-align: none; mso-pagination: none; text-autospace: none;"><span style="font-family: &quot;Tahoma&quot;,sans-serif;">Everyone has their own method but this one works great for me. Hopefully it helps some of you guys out. Happy coding!</span></div></div>