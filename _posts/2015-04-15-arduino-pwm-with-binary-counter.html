---
layout: post
title: Arduino PWM with Binary Counter
date: '2015-04-15T19:24:00.000-07:00'
author: Steven Lavoie
tags:
- electronics
- arduino
- coding
modified_time: '2015-05-30T20:55:00.884-07:00'
thumbnail: http://4.bp.blogspot.com/-9YK6pwWVDcQ/VS8c7qB5ECI/AAAAAAAATFQ/p_VcCDYf6gc/s72-c/20150415_153102.jpg
blogger_id: tag:blogger.com,1999:blog-1636451537745562628.post-6094551104502420548
blogger_orig_url: http://imtryingtoscience.blogspot.com/2015/04/arduino-pwm-with-binary-counter.html
---

<a href="http://4.bp.blogspot.com/-9YK6pwWVDcQ/VS8c7qB5ECI/AAAAAAAATFQ/p_VcCDYf6gc/s1600/20150415_153102.jpg" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" height="200" src="http://4.bp.blogspot.com/-9YK6pwWVDcQ/VS8c7qB5ECI/AAAAAAAATFQ/p_VcCDYf6gc/s1600/20150415_153102.jpg" width="112" /></a>I've got a small handful of ICs so I decided to start trying to figure some of them out. I think it was a random grab bag kinda deal from <a href="http://www.goldmine-elec-products.com/" target="_blank">Electronic Goldmine</a>&nbsp;or <a href="http://www.mouser.com/" target="_blank">Mouser</a>. I ended up with half a dozen binary counters, including a few Motorola SN74LS193Ns.<br /><br />I had an idea what they did, obviously, but I've never actually read and interpreted a datasheet for anything more complicated than an LED so it took me a couple hours, and some Googling, to figure out what was going on.<br /><br />It's a standard IC made by multiple manufacturers. The TI one has more information than the Motorola one but, in the end, I guess it didn't matter much. The main thing is to pain attention to the labels on the diagrams. The LS192 != LS193 so don't use the LS192 data.<br /><br />TI:&nbsp;<a href="http://www.ti.com/lit/ds/symlink/sn54192.pdf">http://www.ti.com/lit/ds/symlink/sn54192.pdf</a><br />Motorola:&nbsp;<a href="https://www.physics.wisc.edu/undergrads/courses/fall2014/623/ds/74LS193.pdf">https://www.physics.wisc.edu/undergrads/courses/fall2014/623/ds/74LS193.pdf</a><br /><br />A couple things that might have been covered in the datasheets but I'm missing due to my lack of experience were found elsewhere with some Google-fu. I also wasn't sure of the Arduino Uno's duty cycle and how it would affect the counter. I did a lot of Googling and just got confused.<br /><br />In the end, I stumbled on <a href="http://z80dave.blogspot.com/2014/02/42-working-with-74193-4-bit-binary.html" target="_blank">this guy's blog</a>, which really pulled the previous stuff together. He actually uses a few of these in series to create a 12-bit counter.<br /><br />1. This <a href="http://www.facstaff.bucknell.edu/mastascu/eLessonsHTML/Logic/Logic5.html" target="_blank">Bucknell course</a>&nbsp;page says to put the CLEAR and LOAD pins to ground. This didn't actually work for me.<br />2. That course <a href="http://www.facstaff.bucknell.edu/mastascu/eLessonsHTML/Labs/Logic/Counters.html" target="_blank">links to a lab</a> that says something a bit different, so I'm guessing something was lost from lecture to web page in the first link. The LOAD pin is active while low, so it should be at +5V if not presetting the counter.<br />3. That blog explicitly shows the author using the reset pin to get started.<br /><br />While the datasheet showed an example of clearing and then loading, it didn't specify exactly how to get started. Maybe these things are standard with binary counters or something...<br /><br />Anyway, I was hoping to reduce my data-pin usage. I wanted the binary counter for a "pedestrian" light in emulating a traffic intersection. I'm already using six pins for the three signals in each of the two lights for the intersection.<br /><br />I expected to be able to just use one pin to count up but, apparently, I need a second pin to reset the device from the get-go. At least that's what the author used in his code. Mine's the same but with a 1s delay in counting so the "pedestrian" has 15 seconds to cross:<br /><br /><pre style="background: #000000; color: #d1d1d1;"><span style="color: #e66170; font-weight: bold;">int</span> countup <span style="color: #d2cd86;">=</span> <span style="color: #008c00;">9</span><span style="color: #b060b0;">;</span><br /><br /><span style="color: #e66170; font-weight: bold;">void</span> setup<span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><br /><span style="color: #b060b0;">{</span><br />  pinMode<span style="color: #d2cd86;">(</span>reset<span style="color: #d2cd86;">,</span>OUTPUT<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  pinMode<span style="color: #d2cd86;">(</span>countup<span style="color: #d2cd86;">,</span>OUTPUT<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br /> <br />  digitalWrite<span style="color: #d2cd86;">(</span>reset<span style="color: #d2cd86;">,</span>LOW<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  digitalWrite<span style="color: #d2cd86;">(</span>countup<span style="color: #d2cd86;">,</span>HIGH<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br /><br />  digitalWrite<span style="color: #d2cd86;">(</span>reset<span style="color: #d2cd86;">,</span>HIGH<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  digitalWrite<span style="color: #d2cd86;">(</span>reset<span style="color: #d2cd86;">,</span>LOW<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span> <br /><span style="color: #b060b0;">}</span><br /><br /><span style="color: #e66170; font-weight: bold;">void</span> loop<span style="color: #d2cd86;">(</span><span style="color: #d2cd86;">)</span><br /><span style="color: #b060b0;">{</span><br />  digitalWrite<span style="color: #d2cd86;">(</span>countup<span style="color: #d2cd86;">,</span>LOW<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  digitalWrite<span style="color: #d2cd86;">(</span>countup<span style="color: #d2cd86;">,</span>HIGH<span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br />  delay<span style="color: #d2cd86;">(</span><span style="color: #008c00;">1000</span><span style="color: #d2cd86;">)</span><span style="color: #b060b0;">;</span><br /><span style="color: #b060b0;">}</span><br /></pre><br />Still working on traffic signals part. The above will be set up to only work when a button is pressed.  What I was hoping to do was to use the CO (carry over) pin as an input to the Arduino so when the 15s elapsed, the walk signal would be turned off and traffic would resume. Unfortunately, the carry over goes high <i>every time</i>&nbsp;the one carries over.    <br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-rLnGsdfFcZQ/VS8c5ppZgaI/AAAAAAAATFE/1GjO1zdkZhY/s1600/20150415_153114.jpg" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" height="360" src="http://2.bp.blogspot.com/-rLnGsdfFcZQ/VS8c5ppZgaI/AAAAAAAATFE/1GjO1zdkZhY/s1600/20150415_153114.jpg" width="640" /></a></div>I'll have to play with this a bit to see how to get the walk signal's completion back to the Arduino without simply counting in the Arduino code.. I'd like to do this in hardware. I'm guessing I can learn how to use AND gates.  